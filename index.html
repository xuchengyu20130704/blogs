<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¬å…±ç¬”è®°é˜…è¯»å™¨ - Supabase Demo</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* --- é¢œè‰²å˜é‡å®šä¹‰ (ç²‰è‰²ä¸»é¢˜) --- */
        :root {
            --primary-color: #ff69b4; /* äº®ç²‰è‰² (Deep Pink) */
            --secondary-color: #ffb6c1; /* æµ…ç²‰è‰² (Light Pink) */
            --background-color: #fce4ec; /* éå¸¸æµ…çš„ç²‰è‰²èƒŒæ™¯ */
            --sidebar-bg: #e91e63; /* ä¾§è¾¹æ æ·±ç²‰è‰² */
            --text-color: #333;
            --sidebar-text: #f8bbd0;
            --sidebar-hover-bg: #c2185b;
        }

        /* å…¨å±€é‡ç½®å’ŒåŸºç¡€æ ·å¼ */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            padding: 0; 
            background-color: var(--background-color); 
            color: var(--text-color); 
        }

        /* --- å¸ƒå±€æ ¸å¿ƒï¼šFlexbox åŒåˆ—å¸ƒå±€ --- */
        #container {
            display: flex;
            min-height: 100vh;
        }
        
        /* å·¦ä¾§è¾¹æ  (èœå•/ç›®å½•) */
        #sidebar {
            width: 250px;
            background-color: var(--sidebar-bg);
            color: white;
            padding: 20px 0;
            box-shadow: 2px 0 5px rgba(0,0,0,0.2);
            flex-shrink: 0;
            position: sticky; /* ä½¿ç›®å½•æ»šåŠ¨æ—¶ä¿æŒåœ¨è§†å£å†… */
            top: 0;
            overflow-y: auto;
        }
        
        /* å³ä¾§ä¸»å†…å®¹åŒºåŸŸ */
        #main-content {
            flex-grow: 1;
            padding: 20px;
            max-width: calc(100% - 250px);
        }
        
        /* èœå•é¡¹æ ·å¼ */
        #sidebar h3 {
            padding: 0 20px 10px 20px;
            margin-top: 0;
            border-bottom: 1px solid var(--sidebar-hover-bg);
            color: white;
        }
        #sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        #sidebar ul li a {
            display: block;
            padding: 10px 20px;
            text-decoration: none;
            color: var(--sidebar-text);
            border-left: 5px solid transparent;
            transition: background-color 0.2s, border-left-color 0.2s;
        }
        #sidebar ul li a:hover, #sidebar ul li.active a {
            background-color: var(--sidebar-hover-bg);
            border-left-color: var(--secondary-color);
            color: white;
        }

        /* å†…å®¹åŒºé€šç”¨æ ·å¼ */
        h1 { border-bottom: 2px solid var(--primary-color); padding-bottom: 10px; margin-top: 0; }
        
        /* ç¬”è®°åˆ—è¡¨æ ·å¼ */
        #notes-list { list-style: none; padding: 0; }
        .category-group { margin-bottom: 30px; border-left: 5px solid var(--secondary-color); padding-left: 15px; }
        .category-group h2 { 
            color: var(--primary-color); 
            font-size: 1.5em; 
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 1px dashed var(--secondary-color);
            padding-bottom: 5px;
        }
        .note-item { 
            background: white; 
            border-radius: 8px; 
            padding: 15px; 
            margin-bottom: 15px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); /* æ›´æŸ”å’Œçš„é˜´å½± */
            transition: transform 0.2s;
        }
        .note-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0,0,0,0.15);
        }
        .note-title { font-size: 1.2em; font-weight: bold; color: var(--primary-color); margin-bottom: 5px; }
        .error { color: red; }
    </style>
</head>
<body>

    <div id="container">

        <nav id="sidebar">
            <h3>ç¬”è®°åˆ†ç±»</h3>
            <ul id="category-menu">
                <li class="active"><a href="#public-notes">ğŸ  æ‰€æœ‰ç¬”è®°</a></li>
                </ul>
        </nav>

        <main id="main-content">
            
            <section id="public-notes">
                <h1>ğŸ“ å…¬å…±ç¬”è®° (æŒ‰åˆ†ç±»)</h1>
                <div id="notes-list">
                    <p class="loading">æ­£åœ¨åŠ è½½å…¬å…±ç¬”è®°åˆ—è¡¨...</p>
                </div>
            </section>

        </main>
    </div> <script>
        // *** æ‚¨çš„æœ€ç»ˆé…ç½®ä¿¡æ¯ (ä½¿ç”¨æ‚¨æä¾›çš„çœŸå®å€¼) ***
        const SUPABASE_URL = 'https://mmuadyrcrkocezjplnwi.supabase.co'; 
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1tdWFkeXJjcmtvY2V6anBsbndpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0OTA2MjQsImV4cCI6MjA4MDA2NjYyNH0.bD-4DlPTJ72HgKO-YG4HV79pVKpQOr4Oec7xpjLLtlw'; 

        // åˆå§‹åŒ–å®¢æˆ·ç«¯
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // --- æ•°æ®è¯»å–å’Œå½’ç±»å‡½æ•° ---

        async function fetchNotes() {
            const listContainer = document.getElementById('notes-list');
            const menuContainer = document.getElementById('category-menu');
            
            listContainer.innerHTML = '<p class="loading">æ­£åœ¨åŠ è½½å…¬å…±ç¬”è®°åˆ—è¡¨...</p>';

            try {
                // è¯·æ±‚ title, content å’Œæ–°çš„ category å­—æ®µ
                const { data: notes, error } = await supabaseClient
                    .from('notes')
                    .select('title, content, category')
                    .order('created_at', { ascending: false }); // ä»æŒ‰æ—¶é—´å€’åº

                if (error) {
                    throw error;
                }

                if (!notes || notes.length === 0) {
                    listContainer.innerHTML = '<p style="text-align:center">ğŸ“­ æ•°æ®åº“é‡Œè¿˜æ²¡æœ‰ç¬”è®°ã€‚</p>';
                    return;
                }

                // 1. æŒ‰ Category åˆ†ç»„
                const groupedNotes = notes.reduce((acc, note) => {
                    // ä½¿ç”¨ 'æœªåˆ†ç±»' ä½œä¸ºé»˜è®¤åˆ†ç±»å
                    const categoryName = note.category || 'æœªåˆ†ç±»';
                    if (!acc[categoryName]) {
                        acc[categoryName] = [];
                    }
                    acc[categoryName].push(note);
                    return acc;
                }, {});

                // 2. æ¸²æŸ“ä¸»å†…å®¹åŒºåŸŸ (æŒ‰åˆ†ç±»åˆ†ç»„å±•ç¤º)
                listContainer.innerHTML = '';
                let newMenuHTML = '<li class="active"><a href="#public-notes">ğŸ  æ‰€æœ‰ç¬”è®°</a></li>'; // ä¿æŒç¬¬ä¸€ä¸ªé“¾æ¥

                for (const category in groupedNotes) {
                    const categoryId = `cat-${category.replace(/\s/g, '_')}`; // åˆ›å»ºä¸€ä¸ªç”¨äºé”šç‚¹è·³è½¬çš„ID
                    
                    // a. æ¸²æŸ“å†…å®¹åŒºçš„åˆ†ç±»æ ‡é¢˜å’Œç¬”è®°
                    const groupDiv = document.createElement('div');
                    groupDiv.className = 'category-group';
                    groupDiv.id = categoryId;
                    groupDiv.innerHTML = `<h2>${escapeHtml(category)} (${groupedNotes[category].length})</h2>`;
                    
                    const ul = document.createElement('ul');
                    ul.style.listStyle = 'none';
                    ul.style.padding = '0';
                    
                    groupedNotes[category].forEach(note => {
                        const li = document.createElement('li');
                        li.className = 'note-item';
                        li.innerHTML = `<div class="note-title">${escapeHtml(note.title)}</div><div class="note-content">${escapeHtml(note.content)}</div>`;
                        ul.appendChild(li);
                    });
                    
                    groupDiv.appendChild(ul);
                    listContainer.appendChild(groupDiv);

                    // b. æ¸²æŸ“ä¾§è¾¹æ çš„åˆ†ç±»é“¾æ¥
                    newMenuHTML += `<li><a href="#${categoryId}">${escapeHtml(category)}</a></li>`;
                }

                // 3. æ›´æ–°ä¾§è¾¹æ èœå•
                menuContainer.innerHTML = newMenuHTML;

            } catch (err) {
                console.error('Fetch Error:', err);
                listContainer.innerHTML = `<p class="error">âŒ åŠ è½½å¤±è´¥: ${err.message}. è¯·æ£€æŸ¥æ§åˆ¶å°ã€‚</p>`;
            }
        }

        function escapeHtml(text) {
            if (!text) return '';
            return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
        }

        // é¡µé¢å¯åŠ¨æ—¶åŠ è½½ç¬”è®°åˆ—è¡¨
        fetchNotes();

    </script>
</body>
</html>
