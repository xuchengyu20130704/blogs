<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯çˆ±ç¬”è®°é˜…è¯»å™¨ - Supabase Demo</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* --- é¢œè‰²å˜é‡å®šä¹‰ (å¯çˆ±äºŒæ¬¡å…ƒä¸»é¢˜) --- */
        :root {
            --primary-color: #ff69b4; /* å¼ºè°ƒè‰²ï¼šä¸­ç²‰è‰² */
            --secondary-color: #ffb6c1; /* æŸ”å’Œè‰²ï¼šæµ…ç²‰è‰² */
            --background-color: #fff0f5; /* ææµ…èƒŒæ™¯è‰²ï¼šå¥¶æ²¹ç²‰ */
            --sidebar-bg: #f7cac9; /* ä¾§è¾¹æ èƒŒæ™¯ï¼šæŸ”å’Œè–°è¡£è‰ç²‰ */
            --text-color: #333; /* ä¸»è¦æ–‡å­—é¢œè‰² */
            --sidebar-text: #2c3e50; /* ä¾§è¾¹æ æ–‡å­—æ·±è‰² */
            --sidebar-hover-bg: #f0f8ff; /* ä¾§è¾¹æ æ‚¬åœï¼šææµ…è“ç™½ */
            --note-bg: white;
            --note-shadow: 0 6px 15px rgba(255, 105, 180, 0.1); /* å¸¦æœ‰ç²‰è‰²è°ƒçš„æŸ”å’Œé˜´å½± */
            --border-radius-lg: 12px; /* æ›´å¤§çš„åœ†è§’ */
        }

        /* å…¨å±€é‡ç½®å’ŒåŸºç¡€æ ·å¼ */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            padding: 0; 
            background-color: var(--background-color); 
            color: var(--text-color); 
        }

        /* --- å¸ƒå±€æ ¸å¿ƒï¼šFlexbox åŒåˆ—å¸ƒå±€ --- */
        #container {
            display: flex;
            min-height: 100vh;
        }
        
        /* å·¦ä¾§è¾¹æ  (èœå•/ç›®å½•) */
        #sidebar {
            width: 250px;
            background-color: var(--sidebar-bg);
            color: var(--sidebar-text);
            padding: 20px 0;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
            flex-shrink: 0;
            position: sticky;
            top: 0;
            overflow-y: auto;
        }
        
        /* å³ä¾§ä¸»å†…å®¹åŒºåŸŸ */
        #main-content {
            flex-grow: 1;
            padding: 30px; /* å¢åŠ å†…è¾¹è· */
            max-width: calc(100% - 250px);
        }
        
        /* èœå•é¡¹æ ·å¼ */
        #sidebar h3 {
            padding: 0 20px 10px 20px;
            margin-top: 0;
            border-bottom: 1px solid var(--secondary-color);
            color: var(--primary-color);
            font-weight: bold;
        }
        #sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        #sidebar ul li a {
            display: block;
            padding: 10px 20px;
            text-decoration: none;
            color: var(--sidebar-text);
            border-left: 5px solid transparent;
            transition: background-color 0.3s, border-left-color 0.3s;
        }
        #sidebar ul li a:hover, #sidebar ul li.active a {
            background-color: var(--sidebar-hover-bg);
            border-left-color: var(--primary-color);
            color: var(--primary-color);
        }

        /* å†…å®¹åŒºé€šç”¨æ ·å¼ */
        h1 { border-bottom: 3px solid var(--secondary-color); padding-bottom: 15px; margin-top: 0; color: var(--primary-color); }
        
        /* ç¬”è®°åˆ—è¡¨æ ·å¼ */
        #notes-list { list-style: none; padding: 0; }
        .category-group { margin-bottom: 40px; border-left: 5px solid var(--primary-color); padding-left: 20px; }
        .category-group h2 { 
            color: var(--primary-color); 
            font-size: 1.8em; 
            margin-top: 0;
            margin-bottom: 20px;
            border-bottom: 1px dashed var(--secondary-color);
            padding-bottom: 5px;
        }
        .note-item { 
            background: var(--note-bg); 
            border-radius: var(--border-radius-lg); 
            padding: 20px; 
            margin-bottom: 15px; 
            box-shadow: var(--note-shadow);
            transition: transform 0.2s;
        }
        .note-item:hover {
            transform: translateY(-3px); /* æå‡æ•ˆæœæ›´æ˜æ˜¾ */
            box-shadow: 0 8px 20px rgba(255, 105, 180, 0.2);
        }
        .note-title { font-size: 1.3em; font-weight: bold; color: var(--primary-color); margin-bottom: 8px; }
        .error { color: red; }
    </style>
</head>
<body>

    <div id="container">

        <nav id="sidebar">
            <h3>ğŸ“– ç¬”è®°åˆ†ç±»</h3>
            <ul id="category-menu">
                <li class="active"><a href="#public-notes">ğŸ  æ‰€æœ‰ç¬”è®°</a></li>
            </ul>
            <div style="padding: 20px; margin-top: 30px; font-size: 0.9em; color: var(--sidebar-text);">
                <p>è¿™æ˜¯æ‚¨çš„å¯çˆ± Supabase é˜…è¯»å™¨ã€‚</p>
            </div>
        </nav>

        <main id="main-content">
            
            <section id="public-notes">
                <h1>âœ¨ å…¬å…±ç¬”è®°åˆ—è¡¨ (æŒ‰åˆ†ç±»)</h1>
                <div id="notes-list">
                    <p class="loading">æ­£åœ¨åŠ è½½å…¬å…±ç¬”è®°åˆ—è¡¨...</p>
                </div>
            </section>

        </main>
    </div> <script>
        // *** æ‚¨çš„æœ€ç»ˆé…ç½®ä¿¡æ¯ (ä½¿ç”¨æ‚¨æä¾›çš„çœŸå®å€¼) ***
        const SUPABASE_URL = 'https://mmuadyrcrkocezjplnwi.supabase.co'; 
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1tdWFkeXJjcmtvY2V6anBsbndpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0OTA2MjQsImV4cCI6MjA4MDA2NjYyNH0.bD-4DlPTJ72HgKO-YG4HV79pVKpQOr4Oec7xpjLLtlw'; 

        // åˆå§‹åŒ–å®¢æˆ·ç«¯
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // --- æ•°æ®è¯»å–å’Œå½’ç±»å‡½æ•° ---

        async function fetchNotes() {
            const listContainer = document.getElementById('notes-list');
            const menuContainer = document.getElementById('category-menu');
            
            listContainer.innerHTML = '<p class="loading">æ­£åœ¨åŠ è½½å…¬å…±ç¬”è®°åˆ—è¡¨...</p>';

            try {
                // è¯»å– title, content å’Œ category å­—æ®µ
                const { data: notes, error } = await supabaseClient
                    .from('notes')
                    .select('title, content, category')
                    .order('created_at', { ascending: false }); 

                if (error) {
                    throw error;
                }

                if (!notes || notes.length === 0) {
                    listContainer.innerHTML = '<p style="text-align:center">ğŸ“­ æ•°æ®åº“é‡Œè¿˜æ²¡æœ‰ç¬”è®°ã€‚</p>';
                    return;
                }

                // 1. æŒ‰ Category åˆ†ç»„
                const groupedNotes = notes.reduce((acc, note) => {
                    const categoryName = note.category || 'æœªåˆ†ç±»';
                    if (!acc[categoryName]) {
                        acc[categoryName] = [];
                    }
                    acc[categoryName].push(note);
                    return acc;
                }, {});

                // 2. æ¸²æŸ“ä¸»å†…å®¹åŒºåŸŸ (æŒ‰åˆ†ç±»åˆ†ç»„å±•ç¤º)
                listContainer.innerHTML = '';
                let newMenuHTML = '<li class="active"><a href="#public-notes">ğŸ  æ‰€æœ‰ç¬”è®°</a></li>'; 

                for (const category in groupedNotes) {
                    // åˆ›å»ºä¸€ä¸ªç”¨äºé”šç‚¹è·³è½¬çš„IDï¼Œæ›¿æ¢ç©ºæ ¼
                    const categoryId = `cat-${category.replace(/\s/g, '_').replace(/[^a-zA-Z0-9_]/g, '')}`; 
                    
                    // a. æ¸²æŸ“å†…å®¹åŒºçš„åˆ†ç±»æ ‡é¢˜å’Œç¬”è®°
                    const groupDiv = document.createElement('div');
                    groupDiv.className = 'category-group';
                    groupDiv.id = categoryId;
                    groupDiv.innerHTML = `<h2>${escapeHtml(category)} (${groupedNotes[category].length})</h2>`;
                    
                    const ul = document.createElement('ul');
                    ul.style.listStyle = 'none';
                    ul.style.padding = '0';
                    
                    groupedNotes[category].forEach(note => {
                        const li = document.createElement('li');
                        li.className = 'note-item';
                        li.innerHTML = `<div class="note-title">${escapeHtml(note.title)}</div><div class="note-content">${escapeHtml(note.content)}</div>`;
                        ul.appendChild(li);
                    });
                    
                    groupDiv.appendChild(ul);
                    listContainer.appendChild(groupDiv);

                    // b. æ¸²æŸ“ä¾§è¾¹æ çš„åˆ†ç±»é“¾æ¥
                    newMenuHTML += `<li><a href="#${categoryId}">${escapeHtml(category)}</a></li>`;
                }

                // 3. æ›´æ–°ä¾§è¾¹æ èœå•
                menuContainer.innerHTML = newMenuHTML;

            } catch (err) {
                console.error('Fetch Error:', err);
                listContainer.innerHTML = `<p class="error">âŒ åŠ è½½å¤±è´¥: ${err.message}. è¯·æ£€æŸ¥æ§åˆ¶å°ã€‚</p>`;
            }
        }

        function escapeHtml(text) {
            if (!text) return '';
            return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
        }

        // é¡µé¢å¯åŠ¨æ—¶åŠ è½½ç¬”è®°åˆ—è¡¨
        fetchNotes();

    </script>
</body>
</html>